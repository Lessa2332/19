<script>
    // ... (–≤–µ—Å—å –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∫–æ–¥ –¥–æ initCanvasGame –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω)

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Canvas-–≥—Ä–∏ (–≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è)
    function initCanvasGame() {
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // –ó–∞–ø—É—Å–∫ –º—É–∑–∏–∫–∏
        if (bgMusic) {
            bgMusic.muted = false;
            bgMusic.play().catch(e => console.log("üîá –ú—É–∑–∏–∫–∞ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—è:", e));
        }

        // –ú–∞—Å–∏–≤ —Å–º–∞–π–ª—ñ–≤
        let emojis = [];
        let score = 0; // –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è score
        const maxEmojisOnScreen = 10; // –ú–∞–∫—Å–∏–º—É–º —Å–º–∞–π–ª—ñ–≤ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
        const sadEmojis = ['üò¢', 'üòû', 'üòü', 'üôÅ', 'üòï']; // –°—É–º–Ω—ñ
        const happyEmojis = ['üòÑ', 'üòÇ', 'üòç', 'üòò', 'ü•≥']; // –í–µ—Å–µ–ª—ñ –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Å–º–∞–π–ª–∞
        function createEmoji() {
            return {
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: 40 + Math.random() * 60, // –†—ñ–∑–Ω—ñ —Ä–æ–∑–º—ñ—Ä–∏
                vx: (Math.random() - 0.5) * 4, // –®–≤–∏–¥—à–∏–π —Ä—É—Ö (¬±2)
                vy: (Math.random() - 0.5) * 4,
                value: sadEmojis[Math.floor(Math.random() * sadEmojis.length)],
                isClicked: false,
                fadeOut: 0 // –î–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è
            };
        }

        // –ü–æ—á–∞—Ç–∫–æ–≤–æ —Å—Ç–≤–æ—Ä—é—î–º–æ 5 —Å–º–∞–π–ª—ñ–≤
        for (let i = 0; i < 5; i++) {
            emojis.push(createEmoji());
        }

        // –¢–∞–π–º–µ—Ä: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ timestamp –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É
        let startTime = Date.now();
        let timer = 60;

        // –¢–µ–∫—Å—Ç–∏ (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ, —è–∫ –≤ –∫–æ–¥—ñ)
        const timerText = document.createElement('div');
        timerText.id = 'canvasTimer';
        timerText.style.position = 'fixed';
        timerText.style.top = '20px';
        timerText.style.left = '50%';
        timerText.style.transform = 'translateX(-50%)';
        timerText.style.color = '#FFD700';
        timerText.style.fontSize = '1.4em';
        timerText.style.fontWeight = 'bold';
        timerText.style.zIndex = '10';
        timerText.textContent = `‚è≥ –ß–∞—Å: 60`;
        document.body.appendChild(timerText);

        const scoreText = document.createElement('div');
        scoreText.id = 'canvasScore';
        scoreText.style.position = 'fixed';
        scoreText.style.top = '60px';
        scoreText.style.left = '50%';
        scoreText.style.transform = 'translateX(-50%)';
        scoreText.style.color = '#00FF7F';
        scoreText.style.fontSize = '1.4em';
        scoreText.style.fontWeight = 'bold';
        scoreText.style.zIndex = '10';
        scoreText.textContent = `üåü –°–º–∞–π–ª–∏–∫—ñ–≤: 0`;
        document.body.appendChild(scoreText);

        // –ß–∞—Å—Ç–∏–Ω–∫–∏ –¥–ª—è —Ñ–µ—î—Ä–≤–µ—Ä–∫—É
        let particles = [];
        function createFirework(x, y) {
            for (let i = 0; i < 20; i++) { // 20 —á–∞—Å—Ç–∏–Ω–æ–∫
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10, // –†–æ–∑–ª—ñ—Ç
                    vy: (Math.random() - 0.5) * 10,
                    size: 5 + Math.random() * 10,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`, // –Ø—Å–∫—Ä–∞–≤—ñ –∫–æ–ª—å–æ—Ä–∏
                    life: 1 // –í—ñ–¥ 1 –¥–æ 0 –¥–ª—è –∑–≥–∞—Å–∞–Ω–Ω—è
                });
            }
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —á–∞—Å—Ç–∏–Ω–æ–∫
        function updateParticles() {
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.1; // –ì—Ä–∞–≤—ñ—Ç–∞—Ü—ñ—è –¥–ª—è –µ—Ñ–µ–∫—Ç—É
                p.life -= 0.02; // –ó–≥–∞—Å–∞–Ω–Ω—è
            });
        }

        // –ú–∞–ª—é–≤–∞–Ω–Ω—è —á–∞—Å—Ç–∏–Ω–æ–∫
        function drawParticles() {
            particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life;
                ctx.fill();
                ctx.globalAlpha = 1;
            });
        }

        // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            emojis.forEach((emoji, index) => {
                if (emoji.isClicked || emoji.fadeOut > 0) return;
                const dx = x - emoji.x;
                const dy = y - emoji.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < emoji.size / 1.5) { // –¢–æ—á–Ω—ñ—à–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è (1.5 –¥–ª—è –µ–º–æ–¥–∑—ñ)
                    emoji.isClicked = true;
                    emoji.value = happyEmojis[Math.floor(Math.random() * happyEmojis.length)]; // –ó–º—ñ–Ω–∞ –Ω–∞ –≤–µ—Å–µ–ª–∏–π
                    emoji.fadeOut = 1; // –ü–æ—á–∞—Ç–æ–∫ –∞–Ω—ñ–º–∞—Ü—ñ—ó –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è
                    score++;
                    scoreText.textContent = `üåü –°–º–∞–π–ª–∏–∫—ñ–≤: ${score}`;
                    createFirework(emoji.x, emoji.y);

                    // –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ —Å–º–∞–π–ª–∞, —è–∫—â–æ –Ω–µ –º–∞–∫—Å–∏–º—É–º
                    if (emojis.length < maxEmojisOnScreen) {
                        emojis.push(createEmoji());
                    }
                }
            });
        });

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
        function animate() {
            if (!isGameRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–º–∞–π–ª—ñ–≤
            emojis = emojis.filter(emoji => emoji.fadeOut > 0 || !emoji.isClicked); // –í–∏–¥–∞–ª—è—Ç–∏ –∑–Ω–∏–∫–ª—ñ
            emojis.forEach(emoji => {
                if (emoji.isClicked && emoji.fadeOut > 0) {
                    // –ê–Ω—ñ–º–∞—Ü—ñ—è –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è: –º–∞—Å—à—Ç–∞–± —ñ –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å
                    emoji.size *= 1.05; // –ó–±—ñ–ª—å—à–µ–Ω–Ω—è
                    emoji.fadeOut -= 0.05;
                    ctx.globalAlpha = emoji.fadeOut;
                } else if (!emoji.isClicked) {
                    // –†—É—Ö
                    emoji.x += emoji.vx;
                    emoji.y += emoji.vy;
                    if (emoji.x < 0 || emoji.x > canvas.width) emoji.vx *= -1;
                    if (emoji.y < 0 || emoji.y > canvas.height) emoji.vy *= -1;
                }

                // –ú–∞–ª—é–≤–∞–Ω–Ω—è
                ctx.font = `${emoji.size}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = 'white';
                ctx.fillText(emoji.value, emoji.x, emoji.y);
                ctx.globalAlpha = 1;
            });

            // –§–µ—î—Ä–≤–µ—Ä–∫
            updateParticles();
            drawParticles();

            // –¢–∞–π–º–µ—Ä: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const remaining = 60 - elapsed;
            if (remaining <= 0) {
                endCanvasGame();
                return;
            }
            timerText.textContent = `‚è≥ –ß–∞—Å: ${String(remaining).padStart(2, '0')}`;

            requestAnimationFrame(animate);
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥—Ä–∏
        function endCanvasGame() {
            isGameRunning = false;
            stopGame();
            document.body.removeChild(timerText);
            document.body.removeChild(scoreText);

            // –ü–æ–∫–∞–∑–∞—Ç–∏ —Ñ—ñ–Ω–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            alert(`–ì—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –¢–∏ –∑—Ä–æ–±–∏–≤ ${score} —Å–º–∞–π–ª—ñ–≤ —â–∞—Å–ª–∏–≤–∏–º–∏! –ó –î–Ω–µ–º –°–º–∞–π–ª–∏–∫–∞ 19 –≤–µ—Ä–µ—Å–Ω—è! üòäüéâ`);
        }

        // –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç–∏"
        document.getElementById('endBtn').addEventListener('click', endCanvasGame);

        // –ü–æ—á–∞—Ç–æ–∫ –∞–Ω—ñ–º–∞—Ü—ñ—ó
        requestAnimationFrame(animate);
    }
</script>
